# Project goal:
# You should create one R script called run_analysis.R that does the following.
# 1. Merges the training and the test sets to create one data set.
dataFilesPath       <- file.path(path, "UCI HAR Dataset")
dataTrainSubject    <- fread(file.path(pathIn, "train", "subject_train.txt"))
dataTrainActivity   <- fread(file.path(pathIn, "train", "Y_train.txt"))
dataTestSubject     <- fread(file.path(pathIn, "test" , "subject_test.txt" ))
dataTestActivity    <- fread(file.path(pathIn, "test" , "Y_test.txt" ))
toDataTable <- function (file) {
dataFile    <- read.table(file)
dataTable   <- data.table(dataFile)
}
trainDataTable  <- toDataTable(file.path(pathIn, "train", "X_train.txt"))
testDataTable   <- toDataTable(file.path(pathIn, "test" , "X_test.txt" ))
dataTableSubject <- rbind(dataTrainSubject, dataTestSubject)
setnames(dataSubject, "V1", "subject")
dataTableActivity <- rbind(dataTrainActivity, dataTestActivity)
setnames(dataActivity, "V1", "activityNum")
dataTable <- rbind(trainDataTable, testDataTable)
dataTableSubject <- cbind(dataTableSubject, dataTableActivity)
dataTable <- cbind(dataTableSubject, dataTable)
setkey(dataTable, subject, activityNum)
path <- getwd()
dataFilesPath       <- file.path(path, "UCI HAR Dataset")
dataTrainSubject    <- fread(file.path(pathIn, "train", "subject_train.txt"))
dataTrainActivity   <- fread(file.path(pathIn, "train", "Y_train.txt"))
dataTestSubject     <- fread(file.path(pathIn, "test" , "subject_test.txt" ))
dataTestActivity    <- fread(file.path(pathIn, "test" , "Y_test.txt" ))
packages <- c("data.table", "reshape2")
sapply(packages, require, character.only=TRUE, quietly=TRUE)
path <- getwd()
dataFilesPath       <- file.path(path, "UCI HAR Dataset")
dataTrainSubject    <- fread(file.path(pathIn, "train", "subject_train.txt"))
dataTrainActivity   <- fread(file.path(pathIn, "train", "Y_train.txt"))
dataTestSubject     <- fread(file.path(pathIn, "test" , "subject_test.txt" ))
dataTestActivity    <- fread(file.path(pathIn, "test" , "Y_test.txt" ))
dataFilesPath       <- file.path(path, "UCI HAR Dataset")
dataTrainSubject    <- fread(file.path(dataFilesPath, "train", "subject_train.txt"))
dataTrainActivity   <- fread(file.path(dataFilesPath, "train", "Y_train.txt"))
dataTestSubject     <- fread(file.path(dataFilesPath, "test" , "subject_test.txt" ))
dataTestActivity    <- fread(file.path(dataFilesPath, "test" , "Y_test.txt" ))
toDataTable <- function (file) {
dataFile    <- read.table(file)
dataTable   <- data.table(dataFile)
}
trainDataTable  <- toDataTable(file.path(pathIn, "train", "X_train.txt"))
testDataTable   <- toDataTable(file.path(pathIn, "test" , "X_test.txt" ))
trainDataTable  <- toDataTable(file.path(dataFilesPath, "train", "X_train.txt"))
testDataTable   <- toDataTable(file.path(dataFilesPath, "test" , "X_test.txt" ))
dataTableSubject <- rbind(dataTrainSubject, dataTestSubject)
setnames(dataSubject, "V1", "subject")
dataTableSubject <- rbind(dataTrainSubject, dataTestSubject)
setnames(dataTableSubject, "V1", "subject")
dataTableActivity <- rbind(dataTrainActivity, dataTestActivity)
setnames(dataTableActivity, "V1", "activityNum")
dataTable <- rbind(trainDataTable, testDataTable)
dataTableSubject <- cbind(dataTableSubject, dataTableActivity)
dataTable <- cbind(dataTableSubject, dataTable)
setkey(dataTable, subject, activityNum)
head(dataTable)
dataTableFeatures <- fread(file.path(dataFilesPath, "features.txt"))
setnames(dataTableFeatures, names(dataTableFeatures), c("featureNum", "featureName"))
dataTableFeatures <- dataTableFeatures[grepl("mean\\(\\)|std\\(\\)", featureName)]
dataTableFeatures$featureCode <- dataTableFeatures[, paste0("V", featureNum)]
select <- c(key(dataTable), dataTableFeatures$featureCode)
dataTable <- dataTable[, select, with=FALSE]
head(dataTable)
dataTable           <- merge(dataTable, dataTableActivityNames , by="activityNum", all.x=TRUE)
setkey(dataTable, subject, activityNum, activityName)
dataTable           <- data.table(melt(dataTable, key(dataTable), variable.name="featureCode"))
dataTable           <- merge(dataTable, dtFeatures[, list(featureNum, featureCode, featureName)], by="featureCode", all.x=TRUE)
dataTable$activity  <- factor(dataTable$activityName)
dataTable$feature   <- factor(dataTable$featureName)
dataTableActivityNames <- fread(file.path(dataFilesPath, "activity_labels.txt"))
setnames(dataTableActivityNames, names(dataTableActivityNames), c("activityNum", "activityName"))
dataTable           <- merge(dataTable, dataTableActivityNames , by="activityNum", all.x=TRUE)
setkey(dataTable, subject, activityNum, activityName)
dataTable           <- data.table(melt(dataTable, key(dataTable), variable.name="featureCode"))
dataTable           <- merge(dataTable, dtFeatures[, list(featureNum, featureCode, featureName)], by="featureCode", all.x=TRUE)
dataTable           <- merge(dataTable, dataTableFeatures[, list(featureNum, featureCode, featureName)], by="featureCode", all.x=TRUE)
dataTable$activity  <- factor(dataTable$activityName)
dataTable$feature   <- factor(dataTable$featureName)
setkey(dataTable, subject, activity, featDomain, featAcceleration, featInstrument, featJerk, featMagnitude, featVariable, featAxis)
tidyData <- dataTable[, list(count = .N, average = mean(value)), by=key(dataTable)]
tidyData <- dataTable[, list(count = .N, average = mean(value)), by=key(dataTable)]
setkey(dataTable, subject, activityNum, activityName)
dataTable           <- data.table(melt(dataTable, key(dataTable), variable.name="featureCode"))
tidyData            <- merge(dataTable, dataTableFeatures[, list(featureNum, featureCode, featureName)], by="featureCode", all.x=TRUE)
head(tidyData)
write.table(tidyData, "tidy.txt")
dataTable        <- merge(dataTable, dataTableActivityNames , by="activityNum", all.x=TRUE)
setkey(dataTable, subject, activityNum, activityName)
dataTable        <- data.table(melt(dataTable, key(dataTable), variable.name="featureCode"))
dataTable           <- merge(dataTable, dtFeatures[, list(featureNum, featureCode, featureName)], by="featureCode", all.x=TRUE)
dataTable$activity  <- factor(dataTable$activityName)
dataTable        <- merge(dataTable, dataTableActivityNames , by="activityNum", all.x=TRUE)
setkey(dataTable, subject, activityNum, activityName)
dataTable        <- data.table(melt(dataTable, key(dataTable), variable.name="featureCode"))
dataTable           <- merge(dataTable, dataTableFeatures[, list(featureNum, featureCode, featureName)], by="featureCode", all.x=TRUE)
